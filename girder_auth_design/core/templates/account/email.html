{% extends "account/base.html" %}

{% load i18n %}

{% block head_title %}{% trans "E-mail Addresses" %}{% endblock %}

{% block content %}
  <h3 class="mb-2">{% trans "E-mail Addresses" %}</h3>

  {% if user.emailaddress_set.all %}
    <p>{% trans 'The following e-mail addresses are associated with your account:' %}</p>

    <form action="{% url 'account_email' %}" class="email_list" method="post">
      {% csrf_token %}
      <fieldset class="blockLabels">
      <ul class="border-t border-gray-300 mt-4">
        {% for emailaddress in user.emailaddress_set.all %}
          <li class="border-b border-gray-300 ctrlHolder py-3">
            <label for="email_radio_{{forloop.counter}}" class="{% if emailaddress.primary %}primary_email{%endif%} flex items-center justify-between">
              <div class="flex items-center w-64">
                <input class="mr-3" id="email_radio_{{forloop.counter}}" type="radio" name="email" {% if emailaddress.primary or user.emailaddress_set.count == 1 %}checked="checked"{%endif %} value="{{emailaddress.email}}"/>

                <span class="block overflow-ellipsis overflow-hidden whitespace-no-wrap max-w-full">{{ emailaddress.email }}</span>
                {% if emailaddress.primary %}<i class="{% trans 'ri-star-s-fill' %} ml-1 text-blue-500"></i>{% endif %}
              </div>
              <div class="flex items-center">

                {% if emailaddress.verified %}
                  <span class="verified border bg-gray-100 mx-1 px-2 py-1 rounded-full text-gray-500 text-tiny">{% trans "verified" %}</span>
                {% else %}
                  <span class="unverified border bg-gray-100 flex items-center mx-1 pl-1 pr-2 rounded-full text-gray-500 text-tiny"><i class="ri-error-warning-line mr-1 text-sm text-red-600"></i>{% trans "unverified" %}</span>
                {% endif %}
              </div>
            </label>
          </li>
        {% endfor %}
      </ul>

      <div class="buttonHolder flex items-center justify-between py-5">
        <button class="primaryAction btn-small text-red-500 hover:bg-red-100 hover:text-red-700" type="submit" name="action_remove" >{% trans 'Remove' %}</button>
        <div>
          <button class="secondaryAction mr-1 btn-small text-blue-500 hover:bg-blue-100 hover:text-blue-700" type="submit" name="action_send" >{% trans 'Re-send Verification' %}</button>
          <button class="secondaryAction primary btn-small" type="submit" name="action_primary" >{% trans 'Make Primary' %}</button>
        </div>
      </div>

    </fieldset>
  </form>

  {% else %}
    <div class="bg-red-500 flex items-center justify-between m-4 px-5 py-4 rounded-lg text-white">
      <i class="ri-error-warning-line mr-4 text-4xl"></i>
      <div><strong>{% trans 'Warning:'%}</strong> {% trans "You currently do not have any e-mail address set up. You should really add an e-mail address so you can receive notifications, reset your password, etc." %}</div>
    </div>
  {% endif %}
  <div class="bg-gray-100 border border-gray-300 mt-3 -mx-5 p-5 rounded-lg">
    <h5 class="text-gray-500">{% trans "Add E-mail Address" %}</h5>
    <form method="post" action="{% url 'account_email' %}" class="add_email">
      <div class="flex items-end">
        {% csrf_token %}
        {{ form.as_p }}
        <button class="primary border border-transparent btn-small mb-3 ml-2" name="action_add" type="submit">{% trans "Add E-mail" %}</button>
      </div>
    </form>
  </div>
{% endblock %}

{% block extra_body %}
  <script type="text/javascript">
  (function() {
    var message = "{% trans 'Do you really want to remove the selected e-mail address?' %}";
    var actions = document.getElementsByName('action_remove');
    if (actions.length) {
      actions[0].addEventListener("click", function(e) {
        if (! confirm(message)) {
          e.preventDefault();
        }
      });
    }
  })();
  </script>
{% endblock %}
